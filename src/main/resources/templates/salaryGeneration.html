<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<script type="text/javascript" th:src="@{/js/settings.js}"></script>
<script type="text/javascript" th:src="@{/js/app.js}"></script>
<link rel="stylesheet" type="text/css" th:href="@{/css/modern.css}" />
<script src="https://www.googletagmanager.com/gtag/js?id=UA-120946860-7"></script>

<script type="text/javascript" th:src="@{/js/myJavaScript.js}"></script>
<style>
body {
	opacity: 0;
}

.uppercase {
	text-transform: uppercase;
}

.my-error-class {
	color: #FF0000;
	font-size: 12px;
	/* red */
}
</style>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag() {
		dataLayer.push(arguments);
	}
	 gtag('js', new Date());

	gtag('config', 'UA-120946860-7');
</script>
<head>
<meta charset="utf-8" />
<title>HRMS</title>
</head>

<body>

	<div class="wrapper">


		<!--  nav start -->
		<nav id="sidebar" class="sidebar" aria-label="Site sidebar">
			<div th:replace="/fragments/sidebar :: div"></div>
		</nav>
		<!-- nav end  -->


		<!-- main start here  -->
		<div class="main">

			<div th:replace="/fragments/header ::div"></div>

			<!-- content div start  -->
			<main class="content">

				<!-- container div start -->
				<div class="container-fluid">


					<!-- header div  -->
					<div class="header">
						<h1 class="header-title">Master</h1>

						<nav aria-label="breadcrumb"></nav>
					</div>
					<!-- header div end  -->


					<!-- main row div  -->
					<div class="row">

						<!-- div column start  -->
						<div class="col-12">

							<!-- card start  -->
							<div class="card">

								<!-- card header  -->
								<div class="card-header" style="background: #f4f7fc;">
									<h5 class="card-title"
										style="text-decoration: underline; color: #dc2eaf;">Salary Generation</h5>

									<!-- div start  -->
							
									<!-- div end -->

								</div>
								<!-- card header end  -->


								<!--  card body start  -->
								<div class="card-body">

									<div class="row">
										<div class="col-12 col-lg-6">
											<div class="form-group">
												<label class="form-label"> Department </label> <label
													style="color: red">*</label> <select id="deptName"
													class="form-control department" name="deptName"
													onchange="getAllByDepartmentId()">
													<option value=" ">Select</option>
													<option th:each="department:${listDepartment}"
														th:text="${department.dephName}"
														th:value="${department.departmentCode}"></option>
												</select>

											</div>
										</div>
										<div class="col-12 col-lg-3">
											<div class="form-group">

												<label> Month </label> <label style="color: red">*</label> <input
													type="date" class="form-control">
											</div>


										</div>


									</div>

									<!-- from  -->
									<!-- table -->
									<div>
										<div class="table-responsive">
											<table class="table table-striped table-bordered"
												style="width: 800px;" aria-describedby="table">
												<tr>
													<th scope="col">Emp Code*</th>
													<th scope="col">Emp Name</th>
													<th scope="col">Card No</th>
													<th scope="col">Father/husband Name</th>
													<th scope="col">Basic Pay</th>
													<th scope="col">DA</th>
													<th scope="col">HRA</th>
													<th scope="col">CCA</th>
													<th scope="col">Conv Allow</th>
													<th scope="col">ESI</th>
													<th scope="col">EPF</th>
													<th scope="col">FPF</th>
													<th scope="col">Pension Fund</th>
													<th scope="col">Bonus</th>
													<th scope="col">Employee Premium</th>
													<th scope="col">Madical Allow</th>
													<th scope="col">Work Days</th>
													<th scope="col">Gross salary(with OT)</th>
													<th scope="col">Net Payable</th>
												</tr>



												<tr>
													<td id="empCodeDropDown"></td>
													<td><input id="emp_name" /></td>
													<td><input id="emp_name" /></td>
													<td><input id="emp_name" /></td>
													<td><input id="basic_pay" /></td>
													<td><input id="_da" /></td>
													<td><input id="_hra" /></td>
													<td><input id="_cca" /></td>
													<td><input id="conv_allow" /></td>
													<td><input id="_esi" /></td>
													<td><input id="_epf" /></td>
													<td><input id="_fpf" /></td>
													<td><input id="pension_fund" /></td>
													<td><input id="_bonus" /></td>
													<td><input id="emp_premium" /></td>
													<td><input id="medical_allow" /></td>
													<td><input id="work_days" /></td>
													<td><input id="gross_salary" /></td>
													<td><input id="net_payable" /></td>
												<tr>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td></td>
												<tr>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td></td>
												<tr>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td></td>
												<tr>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td></td>
												<tr>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td><a class="cl" href=""> </a></td>
													<td></td>
													<td></td>
													<td></td>
												<tr>
													<td></td>
													<td></td>
													<td></td>
													<td><span>Total</span></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
													<td><input type="number" /></td>
											</table>
										</div>


										<div class="table-responsive">
											<table class="table table-striped table-bordered"
												style="width: 800px;" aria-describedby="table">
												<tr>
													<th scope="col">Insurance No*</th>
													<th scope="col">PF No</th>
													<th scope="col">Group Insurance No</th>
													<th scope="col">Employee ESI No</th>
													<th scope="col">Arrear Due</th>
													<th scope="col">Arrear Paid</th>
													<th scope="col">Effective Date</th>
													<th scope="col">Effective Date</th>
												<tr>
													<td><input id="emp_ins_no" /></td>
													<td><input id="pf_no" /></td>
													<td><input id="group_ins_no" /></td>
													<td><input id="emp_esi_no" /></td>
													<td><input id="arrear_due" /></td>
													<td><input id="arrear_paid" /></td>
													<td><input id="effective_date" /></td>
													<td><input id="effective_date" /></td>
											</table>
										</div>
									</div>
									<!-- table end -->


									<!-- form end  -->


								</div>

								<!-- card body end  -->
							</div>
							<!-- card end  -->
						</div>

						<!-- div card end -->




					</div>
					<!-- container div end  -->

				</div>

				<!-- content div  end  -->

			</main>

			<!-- main close  -->

			<footer class="footer">
				<div th:replace="/fragments/footer :: div"></div>
			</footer>
		</div>
	</div>
	<script>
	$(document).ready(function() {
		   var datatablesButtons =  $('#example').DataTable( {
	        "scrollY": 200,
	        "scrollX": true,
	        deferRender:true,
	        lengthChange: false,
	    	buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
            scrollCollapse: true,
            
	    } );
	
		datatablesButtons.buttons().container().appendTo("#example_wrapper .col-md-6:eq(0)")
	    
	} );
	
	
	function getAllByDepartmentId(){
		let deptCode = document.getElementById("deptName").value;
		console.log("dept name : "+deptCode);
		
		document.getElementById("empCodeDropDown").innerHTML = "";
		
		const xhr = new XMLHttpRequest();
	    xhr.open('POST','/employeebydeptcode/'+deptCode,true);
	    xhr.getResponseHeader('content-type','application/json');
	    xhr.onload = function(){
	        if(this.status===200){
	        	let obj;
	        	if(this.responseText != "" && this.responseText != null){
	        		obj = JSON.parse(this.responseText);
	        	}
	            
	            console.log(obj);

	           /*  $('#emp_name').val(obj.empName);
				$('#emp_dept_code').val(obj.departmentCode);
				$('#emp_desig_name').val(obj.empDesignation);
				$('#wef_date').val(obj.dateOfJoining); */
				console.log("department value : "+ obj[0].departmentCode);
				
				var empCode = obj[0].empCode;
				console.log("empCode is : "+ empCode);
				
				/* document.getElementById("empCode").value = obj[0].departmentCode; */
				
				var select = document.createElement("select");
				select.name = "empCode";
				select.id = "empCode";
				select.onchange="getEmployeeByEmpCode()";
				select.append(onchange);
				
				
				for(const val of obj){
					var option = document.createElement("option");
					option.value = val.empCode;
					option.text = val.empCode;
					select.appendChild(option);
				}
				
				document.getElementById("empCodeDropDown").appendChild(select);
				
				select.addEventListener(
					     'change',
					     function() { getEmployeeByEmpCode(this.id); },
					     false
					  );
				
	        }
	        else{
	            console.error("some error occured");
	        }
		
	    }
	    xhr.send();
	}
	
	function getEmployeeByEmpCode(){
		console.log("getEmployeeByEmpCode is running..");
		var empCode = document.getElementById("empCode").value;
		
		const xhr = new XMLHttpRequest();
	    xhr.open('POST','getEmployeeByEmpCode/'+empCode,true);
	    xhr.getResponseHeader('content-type','application/json');
	    xhr.onload = function(){
	        if(this.status===200){
	        	let obj;
	        	if(this.responseText != "" && this.responseText != null){
	        		obj = JSON.parse(this.responseText);
	        	}
	            console.log(obj);
	            $('#emp_name').val(obj.empName);
	            $('#basic_pay').val(obj.basicPay);
	            $('#_da').val(obj.da);
	            $('#_hra').val(obj.hra);
	            $('#_cca').val(obj.cca);
	            $('#conv_allow').val(obj.conveyanceAllow);
	            $('#_esi').val(obj.esi);
	            $('#_epf').val(obj.epf);
	            $('#_fpf').val(obj.fpf);
	            $('#pension_fund').val(obj.pensionFund);
	            $('#_bonus').val(obj.bonus);
	            //$('#emp_premium').val();
	            $('#medical_allow').val(obj.medicalAllow);
	            //$('#work_days').val(obj.basicPay);
	            $('#gross_salary').val(obj.gross);
	            $('#net_payable').val(obj.netPay);
	           
	            $('#emp_ins_no').val(obj.empInsuranceNo);
	            $('#emp_pf').val(obj.pfNo);
	            $('#group_ins_no').val(obj.groupInsuranceNo);
	            $('#emp_esi_no').val(obj.empEsiNo);
	            $('#arrear_due').val(obj.arrearDue);
	            $('#arrear_paid').val(obj.arrearPaid);
	            $('#effective_date').val(obj.esiEffectiveDate);
	            $('#effective_date').val(obj.pfEffectiveDate);
	            
	            
	            //$('#_da').val();
	            //console.log("emp name is : "+ obj.empName);
	            //document.getElementById("emp_name").value = obj.empName;
	            //document.getElementById("emp_name").value = obj.empName;
	        }
	        else{
	            console.error("some error occured");
	        }
		
	    }
	    xhr.send();
	}
	
	
	</script>
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<script
		src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
	<script
		src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
	<script
		src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
	<script
		src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.bootstrap4.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
	<script
		src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
	<script
		src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
	<script
		src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>



</body>
</html>